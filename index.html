<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Consultez les temps d'attente en temps r√©el pour les bus EMT de Madrid. Application moderne avec favoris, mode sombre et rafra√Æchissement automatique.">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EMT Madrid">

    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.tailwindcss.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://api.codetabs.com https://api.allorigins.win https://corsproxy.io https://www.emtmadrid.es; base-uri 'self'; form-action 'self'; frame-ancestors 'none'; upgrade-insecure-requests;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">

    <title>Horaires Bus EMT Madrid - Interface Moderne</title>

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ssellini.github.io/EMT/">
    <meta property="og:title" content="Horaires Bus EMT Madrid - Temps R√©el">
    <meta property="og:description" content="Consultez les temps d'attente en temps r√©el pour les bus EMT de Madrid. Application PWA moderne avec favoris, mode sombre et rafra√Æchissement automatique.">
    <meta property="og:image" content="https://ssellini.github.io/EMT/icons/icon-512.png">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="EMT Madrid">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Horaires Bus EMT Madrid - Temps R√©el">
    <meta name="twitter:description" content="Application PWA pour consulter les horaires des bus EMT de Madrid en temps r√©el">
    <meta name="twitter:image" content="https://ssellini.github.io/EMT/icons/icon-512.png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">

    <!-- Ic√¥nes -->
    <link rel="icon" type="image/svg+xml" href="./icons/icon.svg">
    <link rel="apple-touch-icon" href="./icons/icon-192.png">

    <!-- Tailwind CSS -->
    <!-- Note: SRI non disponible pour Tailwind CDN (contenu dynamique) -->
    <!-- TODO Phase 2: Migrer vers build Tailwind locale pour meilleure s√©curit√© -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- CSS personnalis√© -->
    <link rel="stylesheet" href="./css/styles.css">

    <!-- Configuration Tailwind pour le mode sombre -->
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>

    <!-- Structured Data pour SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Horaires Bus EMT Madrid",
        "applicationCategory": "TravelApplication",
        "operatingSystem": "Any",
        "browserRequirements": "Requires JavaScript. Requires HTML5.",
        "url": "https://ssellini.github.io/EMT/",
        "description": "Application web progressive pour consulter les horaires des bus EMT de Madrid en temps r√©el. Fonctionnalit√©s: favoris, mode sombre, rafra√Æchissement automatique, mode hors ligne.",
        "author": {
            "@type": "Person",
            "name": "Mohamed Sofien Sellini",
            "email": "mohamedsofiensellini@gmail.com"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "EUR"
        },
        "featureList": [
            "Horaires en temps r√©el",
            "Gestion des favoris",
            "Mode sombre",
            "Progressive Web App",
            "Mode hors ligne",
            "Rafra√Æchissement automatique",
            "G√©olocalisation"
        ],
        "screenshot": "https://ssellini.github.io/EMT/icons/screenshot-desktop.png",
        "softwareVersion": "2.0.0",
        "datePublished": "2025-10-24",
        "inLanguage": "fr-FR"
    }
    </script>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 transition-colors duration-200">

    <div class="container mx-auto p-4 md:p-8 max-w-6xl">

        <!-- En-t√™te de l'application -->
        <header class="text-center mb-8">
            <div class="flex justify-center items-center gap-3 sm:gap-4 mb-4">
                <svg class="w-10 h-10 sm:w-12 sm:h-12 text-blue-600 dark:text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.125-.504 1.125-1.125V14.25m-17.25 4.5v-1.875a3.375 3.375 0 003.375-3.375h1.5a1.125 1.125 0 011.125 1.125v-1.5a3.375 3.375 0 00-3.375-3.375H3.375" />
                </svg>
                <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-slate-900 dark:text-slate-50">
                    <span class="hidden sm:inline">Horaires des Bus EMT</span>
                    <span class="sm:hidden">Bus EMT Madrid</span>
                </h1>
            </div>
            <p class="text-sm sm:text-base text-slate-500 dark:text-slate-400 mb-4 px-4">
                Consultez les temps d'attente en temps r√©el<span class="hidden sm:inline"> pour n'importe quel arr√™t √† Madrid</span>.
            </p>

            <!-- Barre d'outils -->
            <div class="flex justify-center items-center gap-2 sm:gap-4 flex-wrap">
                <!-- Theme Selector -->
                <div class="relative">
                    <button
                        id="theme-toggle"
                        onclick="window.Utils.Theme.toggleDropdown()"
                        class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[44px]"
                        aria-label="S√©lectionner un th√®me"
                        title="Changer de th√®me">
                        <span class="theme-icon text-xl">‚òÄÔ∏è</span>
                        <span class="theme-text text-sm font-medium hidden md:inline">Clair</span>
                        <svg class="w-4 h-4 hidden md:inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                        </svg>
                    </button>

                    <!-- Dropdown Menu -->
                    <div
                        id="theme-dropdown"
                        class="hidden absolute top-full mt-2 right-0 sm:left-0 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 py-2 min-w-[200px] z-50"
                        role="menu"
                        aria-label="Menu de s√©lection de th√®me">
                        <button
                            onclick="window.Utils.Theme.apply('light'); window.Utils.Theme.hideDropdown();"
                            class="w-full flex items-center gap-3 px-4 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
                            role="menuitem">
                            <span class="text-xl">‚òÄÔ∏è</span>
                            <span class="text-sm font-medium">Clair</span>
                        </button>
                        <button
                            onclick="window.Utils.Theme.apply('dark'); window.Utils.Theme.hideDropdown();"
                            class="w-full flex items-center gap-3 px-4 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
                            role="menuitem">
                            <span class="text-xl">üåô</span>
                            <span class="text-sm font-medium">Sombre</span>
                        </button>
                        <hr class="my-2 border-slate-200 dark:border-slate-700">
                        <button
                            onclick="window.Utils.Theme.apply('sunset'); window.Utils.Theme.hideDropdown();"
                            class="w-full flex items-center gap-3 px-4 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
                            role="menuitem">
                            <span class="text-xl">üåÖ</span>
                            <span class="text-sm font-medium">Coucher de soleil</span>
                        </button>
                        <button
                            onclick="window.Utils.Theme.apply('ocean'); window.Utils.Theme.hideDropdown();"
                            class="w-full flex items-center gap-3 px-4 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
                            role="menuitem">
                            <span class="text-xl">üåä</span>
                            <span class="text-sm font-medium">Oc√©an</span>
                        </button>
                        <button
                            onclick="window.Utils.Theme.apply('forest'); window.Utils.Theme.hideDropdown();"
                            class="w-full flex items-center gap-3 px-4 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
                            role="menuitem">
                            <span class="text-xl">üå≤</span>
                            <span class="text-sm font-medium">For√™t</span>
                        </button>
                    </div>
                </div>

                <button
                    onclick="window.Favorites.shareFavorites()"
                    class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 px-3 py-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[44px] min-w-[44px] flex items-center justify-center gap-2"
                    title="Partager vos favoris"
                    aria-label="Partager vos favoris via un lien">
                    <span class="text-xl">üîó</span>
                    <span class="text-sm hidden md:inline">Partager</span>
                </button>

                <button
                    onclick="window.Utils.Geolocation.findNearbyStops()"
                    class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 px-3 py-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[44px] min-w-[44px] flex items-center justify-center gap-2"
                    title="Trouver des arr√™ts proches"
                    aria-label="Utiliser la g√©olocalisation pour trouver des arr√™ts proches">
                    <span class="text-xl">üìç</span>
                    <span class="text-sm hidden md:inline">Proches</span>
                </button>

                <button
                    onclick="window.Utils.Notifications.requestPermission()"
                    class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 px-3 py-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[44px] min-w-[44px] flex items-center justify-center gap-2"
                    title="Activer les notifications"
                    aria-label="Activer les notifications pour les alertes de bus">
                    <span class="text-xl">üîî</span>
                    <span class="text-sm hidden md:inline">Notifications</span>
                </button>
            </div>
        </header>

        <!-- Section des favoris -->
        <section id="favorites-container" aria-label="Arr√™ts favoris"></section>

        <!-- Section de l'historique -->
        <section id="history-container" aria-label="Historique de recherche"></section>

        <!-- Formulaire de recherche avec autocomplete -->
        <form id="stop-form" class="mb-8 max-w-lg mx-auto" role="search">
            <label for="stop-search-input" class="sr-only">
                Nom ou num√©ro de l'arr√™t de bus
            </label>
            <div class="relative">
                <div class="flex flex-col sm:flex-row items-center gap-2 shadow-lg rounded-lg p-2 bg-white dark:bg-slate-800">
                    <div class="relative w-full sm:flex-1">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                            üîç
                        </span>
                        <input
                            type="text"
                            id="stop-search-input"
                            list="stops-suggestions"
                            placeholder="Nom ou num√©ro d'arr√™t (ex: Puerta del Sol)"
                            required
                            autocomplete="off"
                            aria-label="Nom ou num√©ro de l'arr√™t de bus"
                            aria-describedby="search-help"
                            aria-autocomplete="list"
                            aria-controls="suggestions-dropdown"
                            class="w-full appearance-none bg-transparent border-none text-lg text-slate-700 dark:text-slate-200 placeholder-slate-400 dark:placeholder-slate-500 py-3 pl-10 pr-4 focus:outline-none">
                        <datalist id="stops-suggestions">
                            <!-- G√©n√©r√© dynamiquement par JavaScript -->
                        </datalist>
                    </div>
                    <button
                        type="submit"
                        class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-md transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Rechercher
                    </button>
                </div>

                <!-- Dropdown de suggestions custom -->
                <div id="suggestions-dropdown"
                     class="hidden absolute top-full left-0 right-0 mt-2 bg-white dark:bg-slate-800 rounded-lg shadow-xl max-h-96 overflow-y-auto z-50 border border-slate-200 dark:border-slate-700"
                     role="listbox">
                    <!-- G√©n√©r√© dynamiquement -->
                </div>
            </div>
            <span id="search-help" class="sr-only">
                Entrez un nom ou un num√©ro d'arr√™t de bus pour consulter les horaires en temps r√©el. Des suggestions appara√Ætront automatiquement.
            </span>
            <p class="text-xs sm:text-sm text-center text-slate-500 dark:text-slate-400 mt-2">
                üí° <span class="hidden sm:inline">Astuce: Tapez au moins 2 caract√®res pour voir les suggestions</span><span class="sm:hidden">Tapez pour voir les suggestions</span><span class="hidden md:inline"> ‚Ä¢ <kbd class="px-2 py-1 bg-slate-200 dark:bg-slate-700 rounded">Ctrl+K</kbd> pour rechercher</span>
            </p>
        </form>

        <!-- Panneau de filtres -->
        <div id="filters-panel" class="hidden mb-6 max-w-4xl mx-auto px-2 sm:px-0">
            <div class="bg-white dark:bg-slate-800 rounded-lg shadow-md p-3 sm:p-4">
                <div class="flex items-center justify-between mb-3 sm:mb-4">
                    <h3 class="text-base sm:text-lg font-semibold text-slate-800 dark:text-slate-100 flex items-center gap-2">
                        <span>üéõÔ∏è</span>
                        <span class="hidden sm:inline">Filtres</span>
                    </h3>
                    <button
                        id="filters-toggle"
                        onclick="window.Filters.toggle()"
                        class="text-xs sm:text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors min-h-[44px] px-3"
                        aria-label="Masquer les filtres">
                        <span id="filters-toggle-text">Masquer</span>
                    </button>
                </div>

                <div id="filters-content">
                    <!-- Filtre par temps d'attente -->
                    <div class="mb-3 sm:mb-4">
                        <label class="block text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            <span class="hidden sm:inline">‚è±Ô∏è Temps d'attente maximum</span>
                            <span class="sm:hidden">‚è±Ô∏è Temps max</span>
                        </label>
                        <div class="flex flex-wrap gap-1.5 sm:gap-2">
                            <button
                                onclick="window.Filters.setMaxTime(null)"
                                class="filter-btn filter-time px-3 sm:px-4 py-2 rounded-md border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:border-blue-500 dark:hover:border-blue-400 transition-colors active text-xs sm:text-sm min-h-[44px]"
                                data-time="all">
                                Tous
                            </button>
                            <button
                                onclick="window.Filters.setMaxTime(5)"
                                class="filter-btn filter-time px-3 sm:px-4 py-2 rounded-md border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:border-blue-500 dark:hover:border-blue-400 transition-colors text-xs sm:text-sm min-h-[44px]"
                                data-time="5">
                                <span class="hidden sm:inline">&lt; </span>5<span class="hidden sm:inline"> min</span>
                            </button>
                            <button
                                onclick="window.Filters.setMaxTime(10)"
                                class="filter-btn filter-time px-3 sm:px-4 py-2 rounded-md border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:border-blue-500 dark:hover:border-blue-400 transition-colors text-xs sm:text-sm min-h-[44px]"
                                data-time="10">
                                <span class="hidden sm:inline">&lt; </span>10<span class="hidden sm:inline"> min</span>
                            </button>
                            <button
                                onclick="window.Filters.setMaxTime(15)"
                                class="filter-btn filter-time px-3 sm:px-4 py-2 rounded-md border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:border-blue-500 dark:hover:border-blue-400 transition-colors text-xs sm:text-sm min-h-[44px]"
                                data-time="15">
                                <span class="hidden sm:inline">&lt; </span>15<span class="hidden sm:inline"> min</span>
                            </button>
                        </div>
                    </div>

                    <!-- Filtre par ligne (g√©n√©r√© dynamiquement) -->
                    <div id="lines-filter" class="mb-3 sm:mb-4">
                        <label class="block text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            üöå Lignes
                        </label>
                        <div id="lines-filter-buttons" class="flex flex-wrap gap-1.5 sm:gap-2">
                            <!-- G√©n√©r√© dynamiquement -->
                        </div>
                    </div>

                    <!-- Filtre par destination -->
                    <div class="mb-3 sm:mb-4">
                        <label for="destination-filter" class="block text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            <span class="hidden sm:inline">üìç Destination (contient)</span>
                            <span class="sm:hidden">üìç Destination</span>
                        </label>
                        <input
                            type="text"
                            id="destination-filter"
                            placeholder="Ex: Centro, Plaza..."
                            class="w-full px-3 sm:px-4 py-2.5 sm:py-2 rounded-md border-2 border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 focus:outline-none focus:border-blue-500 dark:focus:border-blue-400 text-sm min-h-[44px]"
                            oninput="window.Filters.setDestination(this.value)">
                    </div>

                    <!-- Boutons d'action -->
                    <div class="flex gap-2 justify-end items-center">
                        <button
                            onclick="window.Filters.reset()"
                            class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 transition-colors min-h-[44px]">
                            R√©initialiser
                        </button>
                        <span id="filters-count" class="px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium text-blue-600 dark:text-blue-400">
                            <!-- Compteur de r√©sultats -->
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conteneur pour les r√©sultats -->
        <main id="results-container" role="main" aria-live="polite" aria-atomic="false">
            <!-- Message initial -->
            <div id="initial-message" class="text-center text-slate-500 dark:text-slate-400 py-12">
                <p>Veuillez entrer un num√©ro d'arr√™t pour commencer ou choisir un favori.</p>
            </div>

            <!-- Indicateur de chargement -->
            <div id="loader" class="hidden text-center py-12" role="status" aria-label="Chargement en cours">
                <svg class="animate-spin h-8 w-8 text-blue-600 dark:text-blue-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="mt-4 text-slate-600 dark:text-slate-400">Recherche des horaires...</p>
            </div>

            <!-- Message d'erreur -->
            <div id="error-message" class="hidden text-center bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg" role="alert"></div>

            <!-- Informations sur l'arr√™t -->
            <div id="stop-info"></div>

            <!-- Cartes des bus -->
            <div id="bus-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6"></div>
        </main>

        <!-- Footer -->
        <footer class="text-center mt-12 text-xs sm:text-sm text-slate-400 dark:text-slate-500 px-4" role="contentinfo">
            <p>Donn√©es fournies par EMT Madrid.</p>
            <p class="mt-1">
                <span class="hidden sm:inline">Interface am√©lior√©e par Claude Code ‚Ä¢ </span>
                <a href="https://github.com/ssellini/EMT" class="text-blue-600 dark:text-blue-400 hover:underline min-h-[44px] inline-flex items-center" target="_blank" rel="noopener noreferrer">
                    Code source
                </a>
            </p>
            <p class="mt-2 text-xs sm:text-sm">
                <strong>Note :</strong> <span class="hidden sm:inline">Cette application utilise le "web scraping" et peut cesser de fonctionner si le site de l'EMT est mis √† jour.</span><span class="sm:hidden">Application utilisant le web scraping.</span>
            </p>

            <!-- Version et statut -->
            <div class="mt-4 text-xs">
                <p><span class="hidden sm:inline">Version 2.0.0 ‚Ä¢ </span>PWA activ√©e</p>
                <p id="online-status" class="mt-1">
                    <span class="inline-block w-2 h-2 rounded-full bg-green-500 mr-1"></span>
                    En ligne
                </p>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="./js/utils.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/favorites.js"></script>
    <script src="./js/search.js"></script>
    <script src="./js/filters.js"></script>
    <script src="./js/app.js"></script>

    <!-- Script pour g√©rer le statut en ligne/hors ligne -->
    <script>
        window.addEventListener('online', () => {
            const status = document.getElementById('online-status');
            if (status) {
                status.innerHTML = '<span class="inline-block w-2 h-2 rounded-full bg-green-500 mr-1"></span> En ligne';
            }
            window.Utils.showToast('Connexion r√©tablie', 'success');
        });

        window.addEventListener('offline', () => {
            const status = document.getElementById('online-status');
            if (status) {
                status.innerHTML = '<span class="inline-block w-2 h-2 rounded-full bg-red-500 mr-1"></span> Hors ligne';
            }
            window.Utils.showToast('Mode hors ligne activ√©', 'warning');
        });

        // Afficher une notification pour installer la PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Afficher un message apr√®s 5 secondes
            setTimeout(() => {
                if (deferredPrompt) {
                    const install = confirm('Voulez-vous installer cette application sur votre appareil pour un acc√®s rapide ?');
                    if (install) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('PWA install√©e');
                            }
                            deferredPrompt = null;
                        });
                    }
                }
            }, 5000);
        });

        // Log de la version
        console.log('%c EMT Madrid v2.0.0 ', 'background: #2563eb; color: white; font-weight: bold; padding: 5px 10px; border-radius: 3px;');
        console.log('Am√©liorations: Cache API, Fallback multi-proxy, Mode sombre, PWA, Favoris avanc√©s, Auto-refresh');
    </script>
</body>
</html>
